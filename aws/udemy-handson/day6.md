Day6 ELBを用いてWebレイヤの可用性を高める
==

## やること

* AWSにおける設計の考え方
* ELBについて
* ELBを使う場合の設計ポイント

## AWSにおける設計の考え方

* SPOFをなくすことを常に意識する
    * NATインスタンスではなくNATゲートウェイを用いる
    * インメモリキャッシュはElasticCacheのレプリケーション機能を使う
    * メールサーバは冗長性をもたせる、SESを用いる
* ELB
    * LBのマネージドサービス
    * 負荷分散
    * 正常なインスタンスのみにリクエスト
    * オートスケーリング

## ELBについて

* ELBの種類
    * ALB
        * Application Load Balancer
        * L7レイヤの負荷分散
        * 今から使うならCLBではなくALBを使う
    * NLB
        * Network Load Balancer
        * L4レイヤの負荷分散
    * CLB
        * Classic Load Balancer
        * L7レイヤの負荷分散
* EC2の負荷を見ながら均等になるようにリクエストを分散する
* ヘルスチェックで正しい動きをしているインスタンスにリクエストを振る
    * 特定のファイルを指定
    * チェック間隔を設定
    * OKやNGの成功回数を指定
* オートスケーリング
    * 特定の条件でEC2の数を増減させる
    * サーバのリソースや特定の時間帯など
    * 何台増やすか
    * ELB自体もスケールする
* ターゲットグループはALBに紐付けるインスタンスのグループ
* オートスケーリンググループを作成してターゲットグループに紐付ける

## ELBを使う場合の設計ポイント

* AZをまたがったサーバ配置にしてAZ障害に対応できるようにする
* アプリケーションをステートフルにして、そのサーバに振られても処理を継続できるようにする
