# AWSサービス

## AWSインフラ

* リージョンの中にいくつかのアベイラビリティゾーンがある
* AWSサービスの範囲
    * グローバルサービス
        * リージョンに依存しない共通のサービス
        * IAM, CloudFront
    * リージョンサービス
        * 特定のリージョン内でのみ利用するサービス
        * VPC, DynamoDB, Lambda
    * アベイラビリティゾーンサービス
        * 特定のAZでのみ利用するサービス
        * VPCのサブネット, EC2, RDS

## IAM

**AWSへのアクセス制御をするサービス**

* IAMユーザは作成直後は権限が付与されていない
* APIやSDKからAWSを操作するにはアクセスキーIDとシークレットアクセスキーの認証情報が必要

## VPC

**AWSに独立したプライベートネットワーク空間を作成できるサービス**

* インターネットゲートウェイ
    * VPC内のリソースからインターネットへアクセスするためのゲートウェイ
* パブリックサブネット
    * デフォルトゲートウェイへのルーティングにインターネットゲートウェイを指定したサブネット
* プライベートサブネット
    * デフォルトゲートウェイへのルーティングにインターネットゲートウェイを指定していないサブネット
* NATゲートウェイ
    * プライベートサブネットからインターネットへ接続するためのNAT機能
* NATインスタンス
    * インターネットにアクセスできるEC2インスタンス。EC2インスタンスをNATサーバとして利用
* Elastic IP
    * 固定のグローバルIPアドレスを提供するサービス
    * EC2インスタンスを停止するとIPアドレスが変わってしまうため、IPアドレス保持するために利用される
    * EC2にアタッチされていない場合や、アタッチされているインスタンスが停止している場合に料金が発生する
* セキュリティグループ
    * インスタンス単位のファイアウォール機能
    * デフォルトでインバウンドはすべて拒否、アウトバウンドはすべて許可
    * ステートフル
    * 設定後に再起動不要ですぐにルールが適用される
* ネットワークACL
    * サブネット単位のファイアウォール機能
    * デフォルトでインバウンドもアウトバウンドもすべて許可
    * ステートレス

## Auto Scaling

**リソース状況に応じてEC2を自動でスケールアウト、スケールインするサービス**

* AMIからEC2インスタンスを起動するのでAMIを最新介しておくことは重要
* ユーザデータを利用してS3やGitからEC2を最新の状態にする

## Route 53

**可用性の高いDNSを提供するマネージドサービス**

* パブリックホストゾーン
    * 外部向けDNS。インターネットに公開されたDNSドメインのレコードを管理するコンテナ
* プライベートホストゾーン
    * 内部向けDNSVPCに閉じたプライベートネットワーク内のDNSドメインのレコードを管理するコンテナ
* ALIASレコード
    * Route 53固有の仮想リソースレコード
    * DNSクエリに対してAWSサービスのエンドポイントのIPアドレスを直接返す。通常はCNAMEを利用
    * Zone Apexが利用可能
* Zone Apex
    * 管理しているDNSドメインの頂点(Apex)となるノード
    * サブドメインを含まないドメイン名。example.comドメインにおけるexample.com自身
    * ELBやCloudFrontに対してZone ApexレコードをAレコードで指定
* トラフィックルーティング
    * クライアントからのトラフィックを要件に応じて適切に転送

## Direct Connect

**オンプレ環境とAWSの間を専用線で接続するサービス**

* インターネットVPNと比較して品質は高いが高コスト

## CloudFront

**エッジロケーションからコンテンツを配信するCDNサービス**

* オリジンとしてELB, EC2, S2などを指定できる
* 署名付きURLを使って一定時間だけアクセスできるURLを発行できる
* ユーザの地域情報からアクセス制御ができる

## EC2

**仮想サーバを提供するサービス**

* ユーザデータ
    * EC2インスタンスの初回起動時に1回だけスクリプトを実行できる機能
* インスタンスメタデータ
    * EC2自身に関するデータで実行中のインスタンスを設定管理するために使用される

## AMI

**EC2インスタンスを作成する際に使用する仮想マシンイメージ**

* EBS-Backed
    * EBSをOSのルート領域として利用したEC2インスタンス
    * 不揮発性
* Instance Store-Backed
    * インスタンスストアをOSのルート領域として利用したEC2インスタンス
    * 揮発性

## Lambda

**サーバレスのサービス**

## API Gateway

**APIの作成、配布、保守、監視、保護を簡単に行えるサービス**

## VM Import/Export

**オンプレ環境に作成した仮想サーバのマシンイメージをEC2にインポートや、その逆ができるサービス**

## EBS

**永続可能なブロックストレージサービス**

* ストレージタイプ
    * 汎用SSD(gp2)
    * プロビジョンドIOPS SSD(io1)
    * スループット最適化HHD(st1)
* スナップショットによるバックアップ
    * スナップショットはS3へ保管
    * 初回はフルバックアップ、以後は増分で取得

## インスタンスストア

**特定のEC2インスタンスタイプで利用できる無料のストレージサービス**

* エフェメラルディスクとも呼ばれる

## AWS Import/Export

**ユーザから送付された物理ディスクのデータをAWS内のストレージへ転送したり、ユーザの物理ディスクに書き出したりするサービス**

* 移行のために高価なディスクが必要

## RDS

**マネージド型のRDB**

* マルチAZで構築が可能
* マスターデータベースと同じデータベースを複製した、読み取り専用のリードレプリカを構築できる。マルチAZや異なるリージョンで作成可能
* SSLを利用してデータベースインスタンスに接続可能
* MySQLでは接続コマンドのオプションに `--ssl-ca=公開鍵のフルパス` を指定

## Amazon Aurora

**AWSが開発したRDBMS**

* PostgreSQL, MySQLと互換あり、性能は上
* データは3つのAZに格納、各AZで2箇所のディスクに保存される

## DynamoDB

**マネージド型のNoSQL**

* データは3つのAZに格納
* 結果整合性モデル
    * 書き込んだデータは時間が経てば正しく反映されるが、データの読み取りのタイミングによっては書き込んだデータが反映されていない状態になる
    * Consistent Readのオプションを使えば、書き込みが反映された最新データを読み取ることができる

## Redshift

**マネージド型のデータウェアハウス**

* スナップショットでバックアップを作成。自動バックアップを有効にしている場合は8時間毎もしくは5GBの更新があったタイミング
* 自動バックアップの保持期限がすぎると削除されるため、永続化したい場合は手動でバックアップを作成する必要がある
* クロスリージョンスナップショット、別リージョンにもスナップショットを保存できる。デフォルトはRedshiftのクラスタが配置されているリージョンに保存される

## Data Pipeline

**データのETL処理など順次処理(パイプライン処理)ができるサービス**

* ETLのスケジューリング、パイプライン処理をワークフローで定義、処理の成功失敗のイベント通知、オンプレ環境との連携、などができる
* ユースケース
    * 1日1回DynamoDBからデータを取り出し、S3にバックアップした後、取り出し元のDynamoDBのテーブルを削除
    * 複数拠点のWebサーバからアクセスログをS3に定期的に保存、加工し、S3からRedshiftへデータをロード

## Cloud Formation

**インフラリソースを自動でプロビジョニングできるサービス**

* テンプレートに基づいてプロビジョニングしてスタックを作成する
* テンプレート
    * CloudFormationの設定ファイル。プロビジョニングしたいAWSリソースをJSON, YAMLで記述
* スタック
    * テンプレートでプロビジョニングされるAWSリソースの集合

## Elastic Beanstalk

**Webアプリケーションやサービスをサーバにデプロイでき、実行環境の管理もできるサービス**

* 対応アプリケーション
    * Java, .NET, PHP, Node.js, Python, Ruby, Go
* 対応サーバ
    * Apache HTTP Server, Nginx, Passenger, Microsoft IIS

## OpsWorks

**ChefやPuppetを利用した構成管理サービス**

## CloudWatch

**AWS上で稼働するサービスのリソース情報を収集、監視、可視化するサービス**

* 標準メトリクスはAWSでデフォルトで用意されている監視項目、カスタムメトリクスは独自に定義する監視項目
* メモリ使用率、ディスク使用率はカスタムメトリクスが必要
* 基本モニタリングは5分間隔、詳細モニタリングは1分間隔の監視。どちらも最大15ヶ月保存
* CloudWatchアラーム
    * アラームのしきい値とアクションを指定
    * メトリクスが監視対象
        * CPU使用率80%以上を5分間持続した場合にアラームを送信など
* CloudWatch Events
    * AWSのリソースを監視し、あるイベントをトリガにアクションを実行する機能
    * 状態変化などのイベントがトリガになる
        * EC2のステータス変化、スケジュール間隔、AutoScalingの成功失敗など

## VPCフローログ

**VPC内のネットワークインターフェース間で行き来する通信の内容をキャプチャする機能**

# 試験対策

## AWSサービス全体の概要

### アクセス制御サービス

* IAMユーザ作成後にアクセスキーIDとシークレットアクセスキーを作成することで、AWSを操作するAPIがAWS SDKから使用可能となります

### ネットワークサービス

* パブリックサブネットとプライベートサブネットの定義
* NATインスタンスの特徴を覚えておく
* EIPはどのような場合に課金されるか覚えておく
* セキュリティグループとネットワークACLの違いを覚えておく
* Auto ScalingでAMIを最新化することやユーザデータなどを利用する考え方は重要
* Route53には、パブリックホストゾーンとプライベートホストゾーンの2種類の利用方法がある
* Route53は、ELBなどのエンドポイントをエイリアスとして指定することができる。そのため、エンドポイントはCNAMEレコードではなくAレコードとして指定する
* Zone ApexレコードをRoute53で利用するケースを覚える
* CloudFrontのオリジンに指定できるサービスを抑えておく。EC2, ELB, S3といったAWSサービスが指定できるが、オンプレミスのサーバも指定可能

### コンピューティングサービス

* 署名付きURLによるアクセス制御の機能は重要
* CloudFrontは地域制限によるアクセス制御ができることを覚えておく
* EBS-Backedインスタンスはデータを永続化できるが、Instance Store-Backedインスタンスは揮発性のためインスタンス停止時にはデータが削除される
* メタデータで取得できる情報と、ユーザデータの用途を覚えておく

### ストレージサービス

* S3の各機能で何ができるかを押さえておく
* インスタンスストアはエフェメラルディスクとも呼ばれるので、どちらの名称も覚えておく
* AWS Import/ExportとVM Import/Exportは別のサービスなので、混同しないように注意

### データベースサービス

* Auroraの特徴を覚えておく
* RDSはSSL接続を利用できる。接続に使用するコマンドのオプションを覚えておく
* DynamoDBのデータ構造や、格納できるデータの種類を覚えておく
* DynamoDBのデータの保持方法と、結果整合性の仕組みを理解しておく
* Redshiftのバックアップの特徴を覚えておく

### データ通知・連携処理サービス

* DataPipelineを利用する主なユースケースを押さえておく
* Elastic Beanstalkが対応しているアプリケーションとサーバを覚えておく
* EC2のメモリ使用率やディスク使用率を監視するには、カスタムメトリクスの設定が必要
* 基本モニタリングと詳細モニタリングでは、収集したデータの監視間隔が異なる
* CloudWatchアラームとCloudWatch Eventsの特徴の違いを押さえておく
* 運用管理に関連するサービス群の役割の違いを押さえておく
